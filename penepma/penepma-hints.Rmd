---
title: "penepma hints"
author: "John Minter"
date: "Started: 2018-07-23, Last Modified: 2018-07-25"
output:
  html_document:
    keep_md: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Some key items to remember

1. There are subtle changes between versions. Be sure to to create
material files with `material.exe` and `penepma.exe` from the same
release.

2. Old `*.dat` files remaining in the folder where penepma is run
can cause unpredictable side effects. I found that starting the simulation
with a batch file like shown below helps.

```
C:
cd "C:/Apps/penepma16/penepma"
del /f *.dat
Penepma < "Ir-500-on-Ag-250-on-Silica.in"

pause
```


3. The limit to the number of channels you can compute is `1000`. To get the
best energy resolution when using a high accelerating voltage, for example
30 kV to get good beam penetration, consider detecting a smaller energy range.
For our Ir on Ag on silica example, I chose to set the `SENERG` value as:

```
>>>>>>>> Electron beam definition.
SENERG 3.0E+04                   [Energy of the electron beam, in eV]
```

and the energy and angular distributions of emerging particles as:

```
       >>>>>>>> Emerging particles. Energy and angular distributions.
NBE    1e1 1.5e4 1000     [E-interval and no. of energy bins 1e3 max]
```

and to make the photon detectors consistent:

```
       >>>>>>>> Photon detectors (up to 25 different detectors).
                IPSF=0, do not create a phase-space file.
                IPSF=1, creates a phase-space file.
       .
PDANGL 50.0 60.0 0.0 360.0 0             [Angular window, in deg, IPSF]
PDENER 1e1 1.5E+04 1000                [Energy window, no. of channels]
```

I'm checking the performance now...




4. In the `.geo` files, layer thickness values are typically specified
in `microns` or `nm`. These are conveniences for the writer. The real
values are cumulative sums in `cm`. The helper function,
`calculate_penepma_z_shifts()` helps the user get these right.

An example for a typical layer structure is given below. Note that
cumulative shifts are negative!

```{r computeLayerThick, message=FALSE, comment=NA}
library(rpenepma)
# data
l_nm_shifts <- c(500, 250, 1.0e+07)
l_cum_shifts_cm <- calculate_penepma_z_shifts(l_nm_shifts)
print(l_cum_shifts_cm)

```






